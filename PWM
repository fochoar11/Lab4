#include <Arduino.h>
#include <stdint.h>
#include <driver/ledc.h>

// pines para los botones del servo
#define btn1 14
#define btn2 27

// pin del servo
#define servo_pin 25

// configuraci√≥n pwm para servo
#define freq_servo 50      
#define res_servo 8        
#define canal_servo 3      

// variables de control
int posicion_actual = 2;    
const int posiciones[5] = {500, 1000, 1500, 2000, 2500}; 

// prototipos
uint32_t us_to_duty(int us);
void mover_servo(int pos);

void setup() {
  pinMode(btn1, INPUT);
  pinMode(btn2, INPUT);

  ledcSetup(canal_servo, freq_servo, res_servo);
  ledcAttachPin(servo_pin, canal_servo);

  ledcWrite(canal_servo, us_to_duty(posiciones[posicion_actual]));
}

void loop() {
  if (digitalRead(btn1) == HIGH) {
    if (posicion_actual < 4) {
      posicion_actual++;
      mover_servo(posicion_actual);
    }
    delay(200);
  }

  if (digitalRead(btn2) == HIGH) {
    if (posicion_actual > 0) {
      posicion_actual--;
      mover_servo(posicion_actual);
    }
    delay(200);
  }
}

uint32_t us_to_duty(int us) {
  uint32_t max_duty = (1 << res_servo) - 1;
  uint32_t periodo_us = 1000000 / freq_servo; 
  return (us * max_duty) / periodo_us;
}

void mover_servo(int pos) {
  ledcWrite(canal_servo, us_to_duty(posiciones[pos]));
}
